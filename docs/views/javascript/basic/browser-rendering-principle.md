---
title: 浏览器渲染原理
date: 2023-06-27 16:37:52
permalink: /pages/774ed7/
categories:
  - javascript
tags:
  - 浏览器
---

## 什么是渲染

把 html 变成屏幕上的像素信息

<!-- 渲染函数模型 -->

```js
function render(html) {
  // 第一行:****************
  // 第二行:****************
  return pixels
}
```

### 浏览器中输入 url,然后回车,发生了什么事?

主要两件事:1. 网络 2.渲染

1. 网络进程
   获取 html,生成渲染任务交给消息队列等待渲染线程进行渲染

2. 渲染
   渲染流水线:1.得到 html 字符串->2.解析 html->3.样式计算->4.布局->5.分层->6.绘制->7.分块->8.光栅化->9.画->10.最终像素信息

## 解析 HTML

parseHTML,生成 dom,css-om 两棵树.解析 html,解析 css,方便以后的 js 操作

### 浏览器如何渲染页面的?

:::details 浏览器如何渲染页面的

- 当浏览器的网络线程收到 HTML 文档后，会产生一个渣染任务，并将其传递给渣染主线程的消息队列。
- 在事件循环机制的作用下，染主线程取出消息队列中的染任务，开启渲染流程。
- 整个渣染流程分为多个阶段，分别是：HTML 解析、样式计算、布局、分层、绘制、分块、光栅化、画
- 每个阶段都有明确的输入输出，上一个阶段的输出会成为下一个阶段的输入。
- 这样，整个渣染流程就形成了一套组织严密的生产流水线。

- 渣染的第一步是解析 HTML。

* 解析过程中遇到 CSS 解析 CSS，遇到 JS 执行 JS。为了提高解析效率，浏览器在开始解析前，会启动一个预解析的线程，率先下载 HTML 中的外部 CSS 文件和外部的 JS 文件。
* 如果主线程解析到 Link 位置，此时外部的 CSS 文件还没有下载解析好，主线程不会等待，继续解析后续的这是因为下载和解析 CsS 的工作是在预解析线程中进行的。这就是 CSS 不会阻塞 HTML 解析的根本原因。
* 如果主线程解析到 script 位置，会停止解析 HTML，转而等待 JS 文件下载好，并将全局代码解析执行完成后，才能继续解析 HTML。这是因为 JS 代码的执行过程可能会修改当前的 DOM 树，所以 DOM 树的生成必

:::

### 什么是 reflow?

修改 css,如宽度,创建 dom,将会影响布局,样式等变化

- reflow 的本质就是重新计算 layout 树。
- 当进行了会影响布局树的操作后，需要重新计算布局树，会引发 layout。
- 为了避免连续的多次操作导致布局树反复计算，浏览器会合并这些操作，当 JS 代码全部完成后再进行统一计算。所以，改动属性造成的 reflow 是异步完成的。
- 也同样因为如此，当 JS 获取布局属性时，就可能造成无法获取到最新的布局信息
- 浏览器在反复权衡下，最终决定获取属性立即 reflow。

### 什么是 repaint?

- repaint 的本质就是重新根据分层信息计算了绘制指令。
- 当改动了可见样式后，就需要重新计算，会引发 repaint。
- 由于元素的布局信息也属于可见样式，所以 reflow 一定会引起 repaint。

### 什么是 transform?
